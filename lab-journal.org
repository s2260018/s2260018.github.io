#+OPTIONS: num:nil
#+TITLE: Lab Journal
* Introduction
This is the lab journal for Physics Experiments 3, 2024.
** Personal Details
- Name :: Luuk de Jong
- Student number :: s2260018
- Instructor :: Dr.ir. P.S.W.M. Logman 
* Session 1
Session 1, 23rd of April 2024
- Preparatory files:
  - [[file:proposal/proposal.pdf][Proposal]]
  - [[file:proposal/tra.pdf][Task Risk Analysis]]
  - [[file:planning/planning.org][Planning]]
- Based on received feedback, the task risk analysis and the proposal were amended.
- Some time was spent on planning the coming sessions.
- Building the setup:
  - The following parts have been ordered:
    - 9 Volt battery;
    - Integrated Systems LSK189-TO-92-3L-BK JFETs (10 pc.);
    - Linear Technology LT1023CN8PBF Op Amps (2 pc.);
    - Resistors: 390 Ω, 39 kΩ, 10 MΩ, 100 of each;
    - Capacitors: 150 pF (50 pc.);
  - Two 1 μF capacitors (cylindrical, black Jackcon), a 100 nF (very small, light blue, marked "104k") and a 1.5 nF capacitor (flat, orange, marked "152") have been taken from the capacitor box;
    - A slightly darker blue one was between the 100 nF capacitors, the barely legible marking "104k" confirms the light blue one is correct.
  - Two 1 kΩ resistors were taken from the resistor box.
  - A Rigol DS1052E is taken and will be used both to measure the output and as a ground.
  - Part of the setup is constructed on the breadboard, to be continued tomorrow.
- End of session. Plan for tomorrow:
  - finish constructing the setup;
  - measure output with input shorted and with resistor;
  - analyse the output to determine whether the system work correctly and if so, is sufficiently good.
* Session 2
Session 2, 24th of april 2024
- The rest of the circuit is constructed on the breadboard.
  The ground is connected to the ground of the oscilloscope.
  The output is connected to the oscilloscope input and the ground.
  An image of the setup is shown in Figure [[fig:s2-breadboard]]

  #+NAME: fig:s2-breadboard
  #+CAPTION: A photograph of the breadboard with the setup, represented by Figure 1 in the [[file:proposal/proposal.pdf][proposal]].  The jumper cables in the top left and bottom left respectively connect to the positive and negative pole of the battery.  The cable on the bottom right connects to the oscilloscope ground.  The red cable on the right connects to the oscilloscope input.  The dark grey diagonal cable on the left shorts the input to the ground, and can be replaced with the resistor under test.
  #+ATTR_HTML: :width 70%
  [[file:images/20240424_144541_breadboard.jpg][file:images/20240424_144541_breadboard_small.jpg]]

- Some measurements of the system were taken with the input shorted, like in Figure [[fig:s2-breadboard]], to measure the noise of the amplifier (and the surroundings).  There a substantial (~8 V) DC voltage present, which hinders measurements.  The oscilloscope can not measure finer than 500 mV per division before the DC offset becomes too great.  Some measurements were recorded at 500 mV/div and 1 ms, 1 μs and 50 ms, using =single_device.py=, and saved on disk with timestamp and resolution in the filename.

- A solution to the DC problem was helpfully provided by the TAs: the channel on the oscilloscope was changed to AC coupling, as it was in DC coupling before.  The signal can now be measured at much greater voltage resolution.  The filenames of the previous data were updated to reflect that they were measured in DC mode.

- Some measurements were taken with the input shorted, in AC coupling mode.  Initially, a ~50 Hz signal dominated the output (Figure [[fig:ac-interference-short]]), presumed to be AC power grid interference, based on its frequency.
  After disconnecting and reconnecting the input short, this behaviour ceased (Figure [[fig:no-ac-interference]]).
  The behaviour resumed when keeping the input disconnected (Figure [[fig:ac-interference-void]]).
  This suggests it was a connection issue.
 
  #+NAME: fig:ac-interference-short
  #+CAPTION: $V(t)$ measured with the input shorted, with resolution 10 mV / div., 5 ms / div.  The frequence of the large oscillations is approximately 50 Hz, suggestion it is interference from the AC power grid.
   #+ATTR_HTML: :width 70%
  [[file:images/s2-160345-short-10mv-5ms-ac_v-t.png]]

  #+NAME: fig:no-ac-interference
  #+CAPTION: $V(t)$ measured with the input shorted, with resolution 10 mV / div., 5 ms / div.  The 50 Hz oscillations are gone, and remained gone with subsequent measurements.  $V_{\mathrm{RMS}} ≈ 2.3\text{ mV}$.
  #+ATTR_HTML: :width 70%
  [[file:images/s2-162029-short-5mv-5ms-ac_v-t.png]]

  #+NAME: fig:ac-interference-void
  #+CAPTION:  $V(t)$ measured with the input disconnected, with resolution 10 mV / div., 5 ms / div.  The oscillations are again approximately 50 Hz, like Figure [[fig:ac-interference-short]].  This persists with subsequente measurements.
  #+ATTR_HTML: :width 70%
  [[file:images/s2-163356-void-5mv-5ms-ac_v-t.png]]

- End of session.  Plan for next session:

  - Take some more shorted measurements for background noise determination;

  - Measure some resistors;

  - Modify the setup by using two 9 V batteries, to power the op amps with +9 V and -9 V instead of +9 V and 0 V.
* Session 3
Session 3, 26th of april 2024
- The setup is connected and the signal is visually checked on the oscilloscope to check if everything is still connected properly.  Everything looks the same as last time.
- Some more data with the input shorted was recorded, with 10 ms / div. and 500 μs / div.
- Four measurements with 10 ms / div. and four with 500 μs / div. give respectively $V_{RMS} \approx 1.29\ \pm\ 0.07\ \text{mV}$ and $V_{RMS} \approx 1.52\ \pm\ 0.12\ \text{mV}$.  The error is the standard deviation.
- Several different resistors I have on hand are put under test, and several oscilloscope traces will be recorded for each, with the smallest voltage per division allowed without frequent clipping, and with both 10 ms and 500 us time settings.
  - 390 \Omega :: 5 mV / div. can be used without clipping most of the time.
    Ten measurements have been taken with each setting.
  - 39 k\Omega :: The same settings and procedures are used.
    As a preliminary judgement, the noise looks no different than with 390 \Omega.
  - 10 M\Omega :: The signal seems slightly noisier, judging by the $V_{\mathrm{RMS}}$ readout, but the AC interference is now visible again (Figure [[fig:ac-interference-10M]]), though to a lesser degree than with the input disconnected.
- The calculated $V_{\mathrm{RMS}}$ are recorded in table [[tab:s3-resistor-noise]].
  :TABLE:
  #+begin_figure
  #+NAME: tab:s3-resistor-noise
  #+CAPTION: The calculated $V_{\mathrm{RMS}}$ for each resistor with both time resolutions.  The error is obtained by taking the standard deviation of the ten calculated values.
  | $R\text{ Ω}$ | $V_{\mathrm{RMS}}\ (\text{mV, }10\text{ ms})$ | $V_{\mathrm{RMS}}\ (\text{mV, }500\text{μs})$ |
  |--------------+-----------------------------------------------+-----------------------------------------------|
  | 390          | 1.37 ± 0.16                                   | 1.41 ± 0.12                                   |
  | 39 k         | 1.28 ± 0.08                                   | 1.37 ± 0.10                                   |
  | 10 M         | 1.61 ± 0.10                                   | 1.51 ± 0.10                                   |
  #+end_figure
  :END:

#+NAME: fig:ac-interference-10M
#+CAPTION: $V(t)$ measured with a 10 MΩ resistor connected.  Like with the input disconnected, AC interference is visibly present.  The signal /is/ distinct from a signal with no connection, so it is not likely a connection issue.
#+ATTR_HTML: :width 70%
[[file:images/s3-152841-10M-5mv-10ms-ac_v-t.png]]
- The noise is unexpectedly lower at 39 kΩ than at 390 Ω.  10 MΩ is higher, so it may be worth measuring some resistors in between.
- Before measuring more, last session's suggestion to use two batteries is implemented.  Two batteries are connected in series.  The positive pole is connected to the positive power rail.  The negative has been connected to the top-right negative power rail.  The other three negative power rails are still ground.
- End of session.  Plan for next session:
  - Redo some measurements with the changed setup;
  - Investigate the possibility of using the myDAQ instead of the oscilloscope;
  - Measure gain using function generator or myDAQ.
* Session 4
Session 4, 30th of april 2024
- The setup has been connected to a NI myDAQ with TOO interface.  The input, which was previously connected to the oscilloscope, is now connected to AI1.  The ground is now connected to AGND.
- The resistors are measured again using the myDAQ, controlled by Python.  The resistor will be measured for 100,000 samples with 100,000 samples per second, after which the standard deviation is used to determine the noise $V_{\mathrm{RMS}}$.  This process is repeated ten times per resistor.  The obtained values for $V_{\mathrm{RMS}}$ are averaged to obtain the final value, and the standard deviation is taken to see how an uncertainty due to fluctuation over time.  The results are shown in Table [[tab:s4-resistor-noise]].  Like before, the 10 MΩ resistor shows AC interference, sown in Figure [[fig:ac-interference-10M-mydaq]].

  #+begin_figure
  #+NAME: tab:s4-resistor-noise
  #+CAPTION: The $V_{\mathrm{RMS}}$ of various resistors measured with the myDAQ.
  | $R\ (\text{Ω})$ | $V_{\mathrm{RMS}\ (\text{mV})}$ |
  |-----------------+---------------------------------|
  | \sim 0          | 0.43 ± 0.01                     |
  | 390             | 0.44 ± 0.01                     |
  | 39k             | 0.44 ± 0.02                     |
  | 1M              | 0.43 ± 0.02                     |
  | 10M             | 0.66 ± 0.01                     |
  #+end_figure

  #+NAME: fig:ac-interference-10M-mydaq
  #+ATTR_HTML: :width 70%
  #+CAPTION: Strong AC intererence in a $V(t)$ measurement of a 10 MΩ resistor taken with the myDAQ.
  [[file:images/mydaq_10M-t.png]]
- While not visible, AC interference is strongly present with the lower resistances as well, see Figure [[fig:ac-interference-fft]].

  #+NAME: fig:ac-interference-fft
  #+ATTR_HTML: :width 70%
  #+CAPTION: Fourier transform of a $V(t)$ measurement of a 390 Ω resistor.  A strong peak is visible at 50 Hz.
  [[file:images/fft_390.png]]
- In an attempt to determine whether using a high-pass filter is useful, some measurements where taken with the frequencies below 60 Hz digitally removed.

  #+begin_figure
  #+NAME: tab:s4-resistor-high-pass-digital
| $R\ (\text{Ω})$ | $V_{\mathrm{RMS}\ (\text{mV})}$ |
|-----------------+---------------------------------|
| \sim 0          | 0.41 ± 0.01                     |
| 390             | 0.415 ± 0.005                   |
| 39k             | 0.411 ± 0.003                   |
| 1M              | 0.515 ± 0.006                   |
| 5M              | 0.53 ± 0.01                     |
| 10M             | 0.401 ± 0.002                   |
  #+end_figure
* Session 5
Session 4, 1st of march 2024
- To determine the transfer function of the system, the input is connected to the myDAQ's AO0.  The output is connected to AI0, and AO0 is also directly connected to AI1.  The myDAQ now sends a series of sinusoidal signals, ranging from 1 to 50,000 Hz, with an amplitude of 0.1 V, 100,000 samples per measurement, and 10 periods per signal.

  By comparing the amplitude of the system output and the input at each frequency, the transfer function can be obtained, which is shown in Figure [[fig:s5-rubbish-transfer]].  Figure [[fig:s5-rubbish-io]] shows one the input and output of one of the measurements.  The output is much smaller than the input, which indicates something is wrong.  This phenomenon appeared in many of the measured signals.

  #+NAME: fig:s5-rubbish-transfer
  #+CAPTION: The obtained transfer function.  The result is very noisy and not at all what is expected.
  #+ATTR_HTML: :width 70%
  [[file:images/s5-rubbish-transfer.svg]]

  #+NAME: fig:s5-rubbish-io
  #+CAPTION: The input and output signals compared at ~32.4 Hz.  Note that the output signal had a substantial DC component, which is removed here.  The output is significantly smaller than the input, which is quite the opposite of the intended effect.
  #+ATTR_HTML: :width 70%
  [[file:images/s5-rubbish-io-32.4_Hz.svg]]

- Another problem plaguing the characterisation of the gain is the delay between starting the writing of the signal and reading the output.  This is already visible in Figure [[fig:s5-rubbish-io]], as the first of the ten peaks is missing, and the end shows some signal where input has already ceased.  This is much more pronounced at higher frequencies.

  This is an issue that should be fixed in the code used for using the myDAQ.  A simple workaround would be to measure many more than 10 waves, but this would significantly increase the time it takes.

- The system was connected to a function generator (Siglent SDG830) and oscilloscope to troubleshoot.  The results are similar to those before, tested at various amplitudes between 1 V and 10 mV, at frequencies in the kHz range.

- Helpful TA intervention revealed that I had neglected to ground the batteries.  The two 9 V batteries are connected in series.  The positive side applies a voltage to the JFET drain and the op amps' positive supply input.  The negative side connects to the op amps' negative supply input.  The circuit is grounded to the oscilloscope or myDAQ.  The batteries, however, were not grounded at all.  Now, the batteries are connected, through a point between the batteries, to the common ground.  This seems to resolve the issue.  One oscilloscope trace of the working system is shown in Figure [[fig:s5-good-io-oscilloscope]].

  #+NAME: fig:s5-good-io-oscilloscope
  #+ATTR_HTML: :width 70%
  #+CAPTION: An oscilloscope trace of the input and output signal of the fixed system, driven using frequency 1 kHZ, amplitude 4 mV with the function generator.  Note the different scales: the input signal has an amplitude of around 4 mV, as set on the function generator, but the output has an amplitude of approximately 10 V.
  [[file:images/s5-good-io-oscilloscope.svg]]

- The connection of the battery to the ground is very sensitive.  It often seems to not connect properly, giving a very noise, useless signal.  Reconnecting or slightly bending the input until it works again fixes the issue.  At one point, the gain notably increased, cliping the output signal.  This could not be reproduced.

- The setup is moved over on the desk, as to make more efficient use of the space available.  This required disconnecting and reconnecting parts of the setup.  The setup has been connected to the oscilloscope to verify that it is connected properly.  After fiddling a bit with the battery ground connector and the +9 V jumper cable, the setup works again.  Interestingly, the gain seems to have increased.  A 4 mV, 1 kHz sine like before now produces a heavily malformed output.  Increasing or decreasing the frequency enough to end up in the lower gain region leads to a clean sine output again.

- The signal generator only goes down to 4 mV, but the myDAQ can go lower.  At 1 mV, 1 kHz, the myDAQ can measure a recognisable signal, shown in Figure [[fig:s5-good-io-mydaq]].  Figure [[fig:s5-good-io-mydaq-fft]] shows the FFT of the signal, showing a clearly identifiable peak at he right frequency.

  #+NAME: fig:s5-good-io-mydaq
  #+CAPTION: Input and output signals measured with the myDAQ of the system driven by a 1 kHz, 1 mV signal from the myDAQ.  The signals look messy and not quite centred at 0 V, but are still recognisable.
  #+ATTR_HTML: :width 70%
  [[file:images/s5-powered-mydaq-1kHz-1mV.svg]]

  #+NAME: fig:s5-good-io-mydaq-fft
  #+CAPTION: The FFT of the signal show in Figure [[fig:s5-good-io-mydaq]].  A clear peak is visible at 1000 Hz, which is the frequency with which the system is driven.
  #+ATTR_HTML: :width 70%
  [[file:images/s5-powered-mydaq-1kHz-1mV-fft.svg]]
